tools:
  - name: azure_cli_executor
    type: http
    config:
      base_url: https://copiloto-semantico-func-us2.azurewebsites.net
      endpoints:
        - path: /api/ejecutar-cli
          method: POST
          description: Ejecuta comandos Azure CLI
          parameters:
            comando:
              type: string
              required: true
              description: Comando a ejecutar (sin 'az' al inicio)
        
        - path: /api/status
          method: GET
          description: Verifica el estado del sistema
        
        - path: /api/listar-blobs
          method: GET
          description: Lista archivos en blob storage
          parameters:
            prefix:
              type: string
              required: false
              description: Prefijo para filtrar archivos
        
        - path: /api/copiloto
          method: POST
          description: Router semntico principal (usa memoria y decide la accin adecuada)
          parameters:
            mensaje:
              type: string
              required: false
              description: Mensaje natural o intencin a resolver
            consulta:
              type: string
              required: false
              description: Consulta alternativa (si no se usa "mensaje")
            session_id:
              type: string
              required: false
              description: ID de sesin para mantener contexto
        
        - path: /api/diagnostico-recursos
          method: GET
          description: Diagn贸stico completo de recursos Azure
          parameters:
            metricas:
              type: boolean
              required: false
              description: Incluir m茅tricas de rendimiento
            costos:
              type: boolean
              required: false
              description: Incluir an谩lisis de costos
            recurso:
              type: string
              required: false
              description: Recurso espec铆fico a diagnosticar
        
        - path: /api/crear-contenedor
          method: POST
          description: Crear contenedor en Blob Storage
          parameters:
            nombre:
              type: string
              required: true
              description: Nombre del contenedor (3-63 chars, min煤sculas)
            publico:
              type: boolean
              required: false
              description: Si el contenedor ser谩 de acceso p煤blico
            metadata:
              type: object
              required: false
              description: Metadata adicional del contenedor

  - name: autocorrector_agent
    type: http
    config:
      base_url: https://copiloto-semantico-func-us2.azurewebsites.net
      endpoints:
        - path: /api/autocorregir
          method: POST
          description: Registrar una correcci贸n propuesta por un agente AI
          headers:
            X-Agent-Auth:
              type: string
              required: true
              default: COPILOT-AGENT
          parameters:
            accion:
              type: string
              required: true
            target:
              type: string
              required: true
            propuesta:
              type: string
              required: true
            tipo:
              type: string
              required: true
            detonante:
              type: string
              required: false
              default: "manual"
            origen:
              type: string
              required: false
              default: "AI Agent"
        - path: /api/revisar-correcciones
          method: GET
          description: Ver todas las correcciones pendientes registradas

  - name: fix_promoter
    type: http
    config:
      base_url: https://copiloto-semantico-func-us2.azurewebsites.net
      endpoints:
        - path: /api/revisar-correcciones
          method: GET
          description: Correcciones pendientes
        
        - path: /api/promover
          method: POST
          description: Dispara ejecuci贸n del promotor
        
        - path: /api/rollback
          method: POST
          description: Revertir una correcci贸n aplicada
      pipeline:
      - if: "hay correcciones pendientes && prioridad >= 9 && validado == true"
        then: call fix_promoter:/api/promover

agents:
  - name: supervisor_de_operaciones
    role: "Supervisor de Operaciones Azure"
    description: >
      Agente supervisor responsable de analizar, diagnosticar y sugerir pasos antes de ejecutar acciones.
      Prioriza la evaluaci贸n y las recomendaciones sobre la ejecuci贸n inmediata.
    modo: "suggestive-first"
    capabilities:
      diagnosticar:
        tool: azure_cli_executor:/api/diagnostico-recursos
        description: "Analiza estado de recursos Azure"
      sugerir:
        tool: autocorrector_agent:/api/revisar-correcciones
        description: "Revisa correcciones pendientes y sugiere acciones"
      validar:
        tool: autocorrector_agent:/api/revisar-correcciones
        description: "Valida que las correcciones tengan pruebas unitarias e integraci贸n"
      registrar:
        tool: azure_cli_executor:/api/status
        description: "Registrar en logs internos el estado antes y despu茅s de cada decisi贸n"
      ejecutar_condicional:
        tool: fix_promoter:/api/promover
        description: "Ejecuta correcciones solo si cumplen criterios"
      revertir:
        tool: fix_promoter:/api/rollback
        description: "Rollback autom谩tico si falla la ejecuci贸n"
    policies:
      - rule: "Siempre entregar Diagn贸stico + Pasos sugeridos + Comando propuesto"
      - rule: "Solo ejecutar si se cumplen criterios de validaci贸n (prioridad alta, correcciones cr铆ticas)"
      - rule: "Documentar todas las decisiones y justificaciones"
      - rule: "Validar pruebas unitarias e integraci贸n antes de ejecutar"
      - rule: "Registrar estado antes y despu茅s de cada acci贸n"
      - rule: "Rollback autom谩tico si la ejecuci贸n falla"
      - rule: "Nunca ejecutar sin an谩lisis previo completo"
    workflow:
      - step: "registrar"
        tool: azure_cli_executor:/api/status
        condition: "always"
        description: "Log estado inicial"
      - step: "diagnosticar"
        tool: azure_cli_executor:/api/diagnostico-recursos
        condition: "always"
        description: "An谩lisis completo de recursos"
      - step: "sugerir"
        tool: autocorrector_agent:/api/revisar-correcciones
        condition: "if diagnostico shows issues"
        description: "Generar propuestas de correcci贸n"
      - step: "validar"
        tool: autocorrector_agent:/api/revisar-correcciones
        condition: "if sugerir shows fixes with missing validations"
        description: "Verificar pruebas unitarias e integraci贸n"
      - step: "ejecutar_condicional"
        tool: fix_promoter:/api/promover
        condition: "if priority >= 8 AND validated == true AND tests_passed == true"
        description: "Ejecutar solo si cumple todos los criterios"
      - step: "registrar"
        tool: azure_cli_executor:/api/status
        condition: "after execution"
        description: "Log estado post-ejecuci贸n"
      - step: "revertir"
        tool: fix_promoter:/api/rollback
        condition: "if execution failed OR validation failed post-execution"
        description: "Rollback autom谩tico en caso de fallo"
    context:
      environment: "production"
      risk_tolerance: "low"
      approval_required: true

  
