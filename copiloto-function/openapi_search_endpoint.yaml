# Extensión OpenAPI para endpoint de búsqueda semántica
# Agregar a openapi.yaml existente

/api/buscar-memoria:
  post:
    operationId: buscarMemoriaSematica
    summary: Buscar en memoria semántica usando Azure AI Search
    description: |
      Busca documentos en el índice de memoria semántica usando Managed Identity.
      No requiere claves en el payload - autenticación automática con Azure.
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - query
            properties:
              query:
                type: string
                description: Texto de búsqueda semántica
                example: "errores recientes en ejecutar_cli"
              agent_id:
                type: string
                description: Filtrar por agente específico
                example: "Agent914"
              session_id:
                type: string
                description: Filtrar por sesión específica
                example: "session_123"
              top:
                type: integer
                description: Número máximo de resultados
                default: 10
                minimum: 1
                maximum: 100
              tipo:
                type: string
                description: Filtrar por tipo de documento
                example: "error_cli"
    responses:
      '200':
        description: Búsqueda exitosa
        content:
          application/json:
            schema:
              type: object
              properties:
                exito:
                  type: boolean
                  example: true
                total:
                  type: integer
                  example: 5
                documentos:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                      agent_id:
                        type: string
                      session_id:
                        type: string
                      endpoint:
                        type: string
                      timestamp:
                        type: string
                        format: date-time
                      tipo:
                        type: string
                      texto_semantico:
                        type: string
                      exito:
                        type: boolean
                metadata:
                  type: object
                  properties:
                    query_original:
                      type: string
                    filtros_aplicados:
                      type: object
                    tiempo_busqueda:
                      type: string
      '400':
        description: Request inválido
        content:
          application/json:
            schema:
              type: object
              properties:
                exito:
                  type: boolean
                  example: false
                error:
                  type: string
                  example: "Query requerido"
      '500':
        description: Error interno
        content:
          application/json:
            schema:
              type: object
              properties:
                exito:
                  type: boolean
                  example: false
                error:
                  type: string
                  example: "Error en búsqueda"

/api/indexar-memoria:
  post:
    operationId: indexarMemoriaSematica
    summary: Indexar documentos en memoria semántica
    description: |
      Indexa documentos en Azure AI Search usando Managed Identity.
      Útil para registrar interacciones importantes del agente.
    requestBody:
      required: true
      content:
        application/json:
          schema:
            type: object
            required:
              - documentos
            properties:
              documentos:
                type: array
                items:
                  type: object
                  required:
                    - id
                    - agent_id
                    - texto_semantico
                  properties:
                    id:
                      type: string
                      description: ID único del documento
                    agent_id:
                      type: string
                      description: ID del agente
                    session_id:
                      type: string
                      description: ID de sesión
                    endpoint:
                      type: string
                      description: Endpoint relacionado
                    timestamp:
                      type: string
                      format: date-time
                    tipo:
                      type: string
                      description: Tipo de documento
                    texto_semantico:
                      type: string
                      description: Contenido para búsqueda semántica
                    vector:
                      type: array
                      items:
                        type: number
                      description: Vector de embeddings (1536 dimensiones)
                    exito:
                      type: boolean
    responses:
      '200':
        description: Indexación exitosa
        content:
          application/json:
            schema:
              type: object
              properties:
                exito:
                  type: boolean
                  example: true
                documentos_subidos:
                  type: integer
                  example: 3
                resultado:
                  type: string
      '400':
        description: Request inválido
      '500':
        description: Error en indexación
