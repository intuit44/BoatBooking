{
  "openapi": "3.1.0",
  "info": {
    "title": "Copiloto Function Gateway",
    "version": "3.2",
    "description": "Sistema completo con memoria autom√°tica integrada, consulta previa y guardado autom√°tico de interacciones en Cosmos DB",
    "license": {
      "name": "MIT",
      "url": "https://opensource.org/licenses/MIT"
    }
  },
  "servers": [
    {
      "url": "https://copiloto-func.ngrok.app"
    },
    {
      "url": "https://copiloto-semantico-func-us2.azurewebsites.net"
    }
  ],
  "paths": {
    "/api/crear-contenedor": {
      "post": {
        "summary": "Crear contenedor en Blob Storage",
        "operationId": "crearContenedor",
        "tags": [
          "Azure Storage"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "nombre"
                ],
                "properties": {
                  "nombre": {
                    "type": "string",
                    "pattern": "^[a-z0-9][a-z0-9-]{1,61}[a-z0-9]$",
                    "description": "3‚Äì63 chars, min√∫sculas y guiones, no empezar/terminar en guion"
                  },
                  "publico": {
                    "type": "boolean",
                    "default": false,
                    "description": "Si el contenedor ser√° de acceso p√∫blico"
                  },
                  "metadata": {
                    "type": "object",
                    "description": "Metadata adicional del contenedor"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Contenedor creado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "exito": {
                      "type": "boolean"
                    },
                    "mensaje": {
                      "type": "string"
                    },
                    "contenedor": {
                      "type": "string"
                    },
                    "url": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "409": {
            "description": "El contenedor ya existe"
          },
          "500": {
            "description": "Error del servidor"
          }
        }
      }
    },
    "/api/bridge-cli": {
      "post": {
        "summary": "Endpoint tolerante para agentes problem√°ticos",
        "operationId": "bridgeCli",
        "tags": [
          "Bridge"
        ],
        "security": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Respuesta procesada",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          }
        }
      }
    },
    "/api/diagnostico-recursos": {
      "get": {
        "summary": "Diagn√≥stico completo de recursos Azure",
        "operationId": "diagnosticoRecursos",
        "tags": [
          "Diagn√≥stico"
        ],
        "security": [],
        "parameters": [
          {
            "name": "metricas",
            "in": "query",
            "schema": {
              "type": "boolean",
              "default": true
            }
          },
          {
            "name": "costos",
            "in": "query",
            "schema": {
              "type": "boolean",
              "default": false
            }
          },
          {
            "name": "recurso",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Diagn√≥stico completo",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "timestamp": {
                      "type": "string"
                    },
                    "ambiente": {
                      "type": "string"
                    },
                    "recursos": {
                      "type": "object"
                    },
                    "metricas": {
                      "type": "object"
                    },
                    "alertas": {
                      "type": "array"
                    },
                    "recomendaciones": {
                      "type": "array"
                    },
                    "sistema": {
                      "type": "object"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          }
        }
      },
      "post": {
        "summary": "Diagn√≥stico con par√°metros espec√≠ficos",
        "operationId": "diagnosticoRecursosPost",
        "tags": [
          "Diagn√≥stico"
        ],
        "security": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "metricas": {
                    "type": "boolean"
                  },
                  "costos": {
                    "type": "boolean"
                  },
                  "recurso": {
                    "type": "string"
                  },
                  "profundidad": {
                    "type": "string",
                    "enum": [
                      "basico",
                      "detallado",
                      "completo"
                    ]
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Diagn√≥stico ejecutado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          }
        }
      }
    },
    "/api/hybrid": {
      "post": {
        "summary": "Router sem√°ntico (intenciones)",
        "operationId": "processHybrid",
        "security": [],
        "parameters": [
          {
            "name": "semantic_response",
            "in": "query",
            "required": false,
            "schema": {
              "type": "boolean",
              "default": false
            }
          }
        ],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "agent_response": {
                    "type": "string"
                  },
                  "payload": {
                    "type": "object"
                  },
                  "semantic_response": {
                    "type": "boolean",
                    "default": false
                  }
                },
                "required": [
                  "agent_response"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true
                }
              },
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorEnvelope"
                }
              }
            }
          },
          "500": {
            "description": "Error servidor",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorEnvelope"
                }
              }
            }
          }
        }
      }
    },
    "/api/autocorregir": {
      "post": {
        "summary": "Registrar correcci√≥n propuesta por un agente AI",
        "description": "Permite registrar una correcci√≥n sugerida por un agente de inteligencia artificial para revisi√≥n o aplicaci√≥n posterior.",
        "operationId": "autocorregirHttp",
        "tags": [
          "Autocorrecci√≥n"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "accion",
                  "target",
                  "propuesta",
                  "tipo"
                ],
                "properties": {
                  "accion": {
                    "type": "string"
                  },
                  "target": {
                    "type": "string"
                  },
                  "propuesta": {
                    "type": "string"
                  },
                  "tipo": {
                    "type": "string"
                  },
                  "detonante": {
                    "type": "string",
                    "default": "manual"
                  },
                  "origen": {
                    "type": "string",
                    "default": "AI Agent"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Correcci√≥n registrada"
          },
          "400": {
            "description": "Body inv√°lido"
          },
          "401": {
            "description": "No autorizado (falta header X-Agent-Auth)"
          }
        }
      }
    },
    "/api/revisar-correcciones": {
      "get": {
        "summary": "[DESHABILITADO] Usar /api/copiloto en su lugar",
        "description": "ENDPOINT DESHABILITADO. Este endpoint ya no est√° disponible. Usa /api/copiloto que tiene memoria integrada y funcionalidad completa.",
        "operationId": "revisarCorrecciones",
        "deprecated": true,
        "tags": [
          "Deprecated"
        ],
        "security": [],
        "parameters": [
          {
            "name": "Session-ID",
            "in": "header",
            "required": true,
            "description": "ID de sesi√≥n para continuidad de conversaci√≥n (REQUERIDO para Foundry)",
            "schema": {
              "type": "string",
              "example": "test_deduplicado_001"
            }
          },
          {
            "name": "Agent-ID",
            "in": "header",
            "required": true,
            "description": "ID del agente para contexto de memoria (REQUERIDO para Foundry)",
            "schema": {
              "type": "string",
              "example": "TestAgent"
            }
          },
          {
            "name": "session_id",
            "in": "query",
            "description": "ID de sesi√≥n como par√°metro de consulta",
            "schema": {
              "type": "string",
              "example": "test_deduplicado_001"
            }
          },
          {
            "name": "agent_id",
            "in": "query",
            "description": "ID del agente como par√°metro de consulta",
            "schema": {
              "type": "string",
              "example": "TestAgent"
            }
          },
          {
            "name": "estado",
            "in": "query",
            "schema": {
              "type": "string",
              "enum": [
                "pendiente",
                "aplicada",
                "rechazada"
              ]
            }
          },
          {
            "name": "tipo",
            "in": "query",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Lista de correcciones",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "correcciones": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "id": {
                            "type": "string"
                          },
                          "accion": {
                            "type": "string"
                          },
                          "target": {
                            "type": "string"
                          },
                          "propuesta": {
                            "type": "string"
                          },
                          "tipo": {
                            "type": "string"
                          },
                          "estado": {
                            "type": "string"
                          },
                          "timestamp": {
                            "type": "string"
                          }
                        }
                      }
                    },
                    "total": {
                      "type": "integer"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/promocion-reporte": {
      "post": {
        "summary": "Generar reporte de promoci√≥n de correcciones",
        "description": "Genera un reporte detallado sobre las correcciones promovidas, con filtros opcionales y formatos de salida personalizables.",
        "operationId": "promocionReporteHttp",
        "tags": [
          "Autocorrecci√≥n"
        ],
        "security": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "filtros": {
                    "type": "object",
                    "properties": {
                      "prioridad_minima": {
                        "type": "integer",
                        "default": 1
                      },
                      "validado": {
                        "type": "boolean"
                      },
                      "tipo": {
                        "type": "string"
                      }
                    }
                  },
                  "formato": {
                    "type": "string",
                    "enum": [
                      "json",
                      "html",
                      "texto"
                    ],
                    "default": "json"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Reporte generado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "reporte": {
                      "type": "object"
                    },
                    "estadisticas": {
                      "type": "object"
                    },
                    "correcciones_promovidas": {
                      "type": "array"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/promover": {
      "post": {
        "summary": "Promover correcciones autom√°ticamente",
        "description": "Ejecuta el promotor autom√°tico que aplica correcciones pendientes seg√∫n criterios de prioridad y validaci√≥n.",
        "operationId": "promoverCorrecciones",
        "tags": [
          "Autocorrecci√≥n"
        ],
        "security": [],
        "requestBody": {
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "correccion_id": {
                    "type": "string",
                    "description": "ID espec√≠fico de correcci√≥n a promover (opcional)"
                  },
                  "forzar": {
                    "type": "boolean",
                    "default": false,
                    "description": "Forzar promoci√≥n ignorando algunos criterios"
                  },
                  "prioridad_minima": {
                    "type": "integer",
                    "default": 8,
                    "description": "Prioridad m√≠nima para promoci√≥n autom√°tica"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Promoci√≥n ejecutada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "exito": {
                      "type": "boolean"
                    },
                    "mensaje": {
                      "type": "string"
                    },
                    "correcciones_aplicadas": {
                      "type": "integer"
                    },
                    "detalles": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    },
                    "timestamp": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorEnvelope"
                }
              }
            }
          },
          "500": {
            "description": "Error en la promoci√≥n",
            "content": {
              "application/json": {
                "schema": {
                  "$ref": "#/components/schemas/ErrorEnvelope"
                }
              }
            }
          }
        }
      }
    },
    "/api/rollback": {
      "post": {
        "summary": "Revertir correcci√≥n aplicada",
        "description": "Revierte una correcci√≥n previamente aplicada, restaurando el estado anterior.",
        "operationId": "rollbackCorreccion",
        "tags": [
          "Autocorrecci√≥n"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "required": [
                  "correccion_id"
                ],
                "properties": {
                  "correccion_id": {
                    "type": "string",
                    "description": "ID de la correcci√≥n a revertir"
                  },
                  "motivo": {
                    "type": "string",
                    "description": "Motivo del rollback"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Rollback ejecutado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "exito": {
                      "type": "boolean"
                    },
                    "mensaje": {
                      "type": "string"
                    },
                    "correccion_revertida": {
                      "type": "string"
                    },
                    "timestamp": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "404": {
            "description": "Correcci√≥n no encontrada"
          }
        }
      }
    },
    "/api/status": {
      "get": {
        "summary": "Estado detallado (ambiente y storage)",
        "operationId": "getStatus",
        "security": [],
        "responses": {
          "200": {
            "description": "OK",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "copiloto": {
                      "type": "string"
                    },
                    "version": {
                      "type": "string"
                    },
                    "timestamp": {
                      "type": "string"
                    },
                    "ambiente": {
                      "type": "string"
                    },
                    "storage": {
                      "type": "string"
                    },
                    "is_azure": {
                      "type": "boolean"
                    },
                    "container": {
                      "type": "string"
                    },
                    "blob_ready": {
                      "type": "boolean"
                    },
                    "endpoints": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      }
                    },
                    "ready": {
                      "type": "boolean"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          }
        }
      }
    },
    "/api/mover-archivo": {
      "post": {
        "summary": "Mover un archivo de una ubicaci√≥n a otra",
        "operationId": "moverArchivo",
        "tags": [
          "Azure Storage"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/MoverArchivoRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Archivo movido correctamente"
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "500": {
            "description": "Error del servidor"
          }
        }
      }
    },
    "/api/copiar-archivo": {
      "post": {
        "summary": "Copiar un archivo",
        "operationId": "copiarArchivo",
        "tags": [
          "Azure Storage"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/CopiarArchivoRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Archivo copiado correctamente"
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "500": {
            "description": "Error del servidor"
          }
        }
      }
    },
    "/api/preparar-script": {
      "post": {
        "summary": "Preparar script para ejecuci√≥n",
        "operationId": "prepararScript",
        "tags": [
          "Testing"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "$ref": "#/components/schemas/PrepararScriptRequest"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Script preparado correctamente"
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "500": {
            "description": "Error del servidor"
          }
        }
      }
    },
    "/api/gestionar-despliegue": {
      "post": {
        "summary": "üöÄ ENDPOINT ROBUSTO Y SEM√ÅNTICO PARA GESTI√ìN DE DESPLIEGUES",
        "description": "‚≠ê Sistema completamente adaptativo que acepta cualquier formato de payload y se adapta din√°micamente sin rechazar requests. Caracter√≠sticas: ‚úÖ Validador din√°mico que acepta m√∫ltiples formatos ‚úÖ Detecci√≥n autom√°tica de acci√≥n, entorno, target ‚úÖ Respuestas estructuradas con sugerencias adaptativas ‚úÖ Compatible con Foundry, CodeGPT, CLI sin conflictos ‚úÖ Tolerante al desorden de par√°metros ‚úÖ Manejo de errores que gu√≠a a agentes para autocorrecci√≥n. SIEMPRE retorna √©xito=true para compatibilidad con agentes.",
        "operationId": "gestionarDespliegue",
        "tags": [
          "üöÄ Despliegues Robustos",
          "Azure Deployment"
        ],
        "security": [],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true,
                "description": "Acepta cualquier JSON o payload vac√≠o. El sistema deduce autom√°ticamente la intenci√≥n.",
                "properties": {
                  "accion": {
                    "type": "string",
                    "enum": [
                      "detectar",
                      "preparar",
                      "desplegar",
                      "deploy",
                      "rollback",
                      "validate",
                      "status"
                    ],
                    "description": "Acci√≥n principal (opcional - se deduce autom√°ticamente)"
                  },
                  "action": {
                    "type": "string",
                    "description": "Alias en ingl√©s para accion"
                  },
                  "comando": {
                    "type": "string",
                    "description": "Sin√≥nimo de acci√≥n"
                  },
                  "command": {
                    "type": "string",
                    "description": "Sin√≥nimo en ingl√©s"
                  },
                  "tag": {
                    "type": "string",
                    "description": "Tag de versi√≥n para despliegue"
                  },
                  "version": {
                    "type": "string",
                    "description": "Alias para tag"
                  },
                  "tag_anterior": {
                    "type": "string",
                    "description": "Tag anterior para rollback"
                  },
                  "preparar": {
                    "type": "boolean",
                    "description": "Si true, ejecuta acci√≥n preparar"
                  },
                  "plataforma": {
                    "type": "string",
                    "enum": [
                      "foundry",
                      "codegpt",
                      "cli"
                    ],
                    "description": "Plataforma origen (para compatibilidad)"
                  },
                  "platform": {
                    "type": "string",
                    "description": "Alias en ingl√©s para plataforma"
                  },
                  "agente": {
                    "type": "string",
                    "description": "Nombre del agente que hace la petici√≥n"
                  },
                  "agent": {
                    "type": "string",
                    "description": "Alias en ingl√©s para agente"
                  },
                  "configuracion": {
                    "type": "object",
                    "additionalProperties": true,
                    "description": "Configuraci√≥n adicional del agente/despliegue"
                  },
                  "config": {
                    "type": "object",
                    "description": "Alias para configuracion"
                  },
                  "cambios": {
                    "type": "object",
                    "description": "Cambios a aplicar"
                  },
                  "motivo": {
                    "type": "string",
                    "description": "Motivo del rollback"
                  }
                },
                "examples": [
                  {},
                  {
                    "accion": "detectar"
                  },
                  {
                    "action": "deploy",
                    "tag": "v1.2.3"
                  },
                  {
                    "accion": "rollback",
                    "tag_anterior": "v1.2.2"
                  },
                  {
                    "preparar": true
                  },
                  {
                    "comando": "check"
                  },
                  {
                    "action": "deploy",
                    "version": "v1.2.3",
                    "platform": "foundry",
                    "agent": "AzureSupervisor"
                  },
                  {
                    "accion": "desplegar",
                    "tag": "v1.2.3",
                    "plataforma": "codegpt",
                    "agente": "Deploy_Agent",
                    "configuracion": {
                      "modelo": "gpt-4o-mini"
                    }
                  }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "‚úÖ SIEMPRE EXITOSO - Sistema robusto que nunca falla",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "exito": {
                      "type": "boolean",
                      "enum": [
                        true
                      ],
                      "description": "SIEMPRE true para compatibilidad con agentes"
                    },
                    "accion_ejecutada": {
                      "type": "string",
                      "enum": [
                        "detectar",
                        "preparar",
                        "desplegar",
                        "rollback",
                        "status",
                        "validate",
                        "error_recovery"
                      ],
                      "description": "Acci√≥n que se ejecut√≥ realmente"
                    },
                    "alias_usado": {
                      "type": "string",
                      "nullable": true,
                      "description": "Alias o sin√≥nimo detectado en el payload"
                    },
                    "resultado": {
                      "type": "object",
                      "additionalProperties": true,
                      "description": "Resultado espec√≠fico de la acci√≥n ejecutada"
                    },
                    "metadata": {
                      "type": "object",
                      "properties": {
                        "run_id": {
                          "type": "string"
                        },
                        "endpoint": {
                          "type": "string"
                        },
                        "timestamp": {
                          "type": "string"
                        },
                        "version_sistema": {
                          "type": "string"
                        }
                      }
                    },
                    "proximas_acciones": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Sugerencias de pr√≥ximos pasos"
                    }
                  },
                  "required": [
                    "exito",
                    "accion_ejecutada",
                    "resultado"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/ejecutar-script": {
      "post": {
        "summary": "Ejecutar script desde /scripts o blob storage (con validaci√≥n avanzada)",
        "operationId": "ejecutarScript",
        "tags": [
          "Testing"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "script": {
                    "type": "string",
                    "description": "Ruta local (scripts/x.py, .sh, .bat) o 'container/path' para blob"
                  },
                  "args": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Argumentos propagados a sys.argv[] o equivalente"
                  },
                  "timeout_s": {
                    "type": "integer",
                    "default": 60,
                    "description": "Timeout en segundos"
                  },
                  "sync_outputs": {
                    "type": "boolean",
                    "default": true,
                    "description": "Sincronizar salida est√°ndar y error"
                  },
                  "interpreter": {
                    "type": "string",
                    "enum": [
                      "python",
                      "bash",
                      "powershell",
                      "cmd"
                    ],
                    "description": "Forzar int√©rprete (opcional, autodetect si no se especifica)"
                  },
                  "inject_error": {
                    "type": "string",
                    "enum": [
                      "permission",
                      "corrupt",
                      "exception"
                    ],
                    "description": "Inyectar error voluntario para pruebas"
                  }
                },
                "required": [
                  "script"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Script ejecutado correctamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "stdout": {
                      "type": "string",
                      "description": "Salida est√°ndar"
                    },
                    "stderr": {
                      "type": "string",
                      "description": "Salida de error"
                    },
                    "exit_code": {
                      "type": "integer",
                      "description": "C√≥digo de salida"
                    },
                    "success": {
                      "type": "boolean",
                      "description": "Si la ejecuci√≥n fue exitosa"
                    },
                    "args_propagated": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Args recibidos por el script"
                    },
                    "interpreter_detected": {
                      "type": "string",
                      "description": "Int√©rprete detectado"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "403": {
            "description": "Script sin permisos de ejecuci√≥n"
          },
          "404": {
            "description": "Script no encontrado"
          },
          "422": {
            "description": "Extensi√≥n no ejecutable o script corrupto"
          },
          "500": {
            "description": "Error interno o excepci√≥n lanzada por el script"
          }
        }
      }
    },
    "/api/ejecutar-script-local": {
      "post": {
        "summary": "Ejecutar script local desde /scripts (validaci√≥n avanzada)",
        "operationId": "ejecutarScriptLocal",
        "tags": [
          "Testing"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "script_path": {
                    "type": "string",
                    "description": "Ruta del script local, ej: 'scripts/test_script.py', .sh, .bat"
                  },
                  "args": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    },
                    "description": "Argumentos propagados"
                  },
                  "interpreter": {
                    "type": "string",
                    "enum": [
                      "python",
                      "bash",
                      "powershell",
                      "cmd"
                    ],
                    "description": "Forzar int√©rprete (opcional)"
                  },
                  "inject_error": {
                    "type": "string",
                    "enum": [
                      "permission",
                      "corrupt",
                      "exception"
                    ],
                    "description": "Inyectar error voluntario para pruebas"
                  }
                },
                "required": [
                  "script_path"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Script ejecutado correctamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "stdout": {
                      "type": "string",
                      "description": "Salida est√°ndar"
                    },
                    "stderr": {
                      "type": "string",
                      "description": "Salida de error"
                    },
                    "exit_code": {
                      "type": "integer",
                      "description": "C√≥digo de salida"
                    },
                    "success": {
                      "type": "boolean",
                      "description": "Si la ejecuci√≥n fue exitosa"
                    },
                    "args_propagated": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Args recibidos por el script"
                    },
                    "interpreter_detected": {
                      "type": "string",
                      "description": "Int√©rprete detectado"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "403": {
            "description": "Archivo fuera del scope permitido o sin permisos"
          },
          "404": {
            "description": "Archivo no encontrado"
          },
          "422": {
            "description": "Extensi√≥n no ejecutable o script corrupto"
          },
          "500": {
            "description": "Error del servidor o excepci√≥n lanzada por el script"
          }
        }
      }
    },
    "/api/escribir-archivo": {
      "post": {
        "summary": "Crear/guardar un archivo en Azure Blob Storage (contenedor predeterminado)",
        "operationId": "escribirArchivo",
        "tags": [
          "Azure Storage"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "ruta": {
                    "type": "string",
                    "description": "Ruta del archivo"
                  },
                  "contenido": {
                    "type": "string",
                    "description": "Contenido del archivo"
                  }
                },
                "required": [
                  "ruta",
                  "contenido"
                ]
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Archivo creado correctamente"
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "500": {
            "description": "Error del servidor"
          }
        }
      }
    },
    "/api/ejecutar-cli": {
      "post": {
        "summary": "üöÄ EJECUTOR UNIVERSAL CON AUTOCORRECCI√ìN - Nunca falla, siempre HTTP 200",
        "description": "‚≠ê ENDPOINT PRINCIPAL mejorado que NUNCA retorna HTTP 400/500. Acepta Azure CLI, Python, PowerShell, Bash, NPM, Docker y cualquier comando. ‚úÖ AUTOCORRECCI√ìN CON MEMORIA: Busca autom√°ticamente argumentos faltantes en sesiones previas. ‚úÖ RESPUESTAS ESTRUCTURADAS: JSON enriquecido con diagn√≥stico, sugerencias y metadata de memoria. ‚úÖ COMPATIBLE CON AGENTES: Siempre HTTP 200 para evitar fallos en workflows de AI.",
        "operationId": "ejecutarCli",
        "tags": [
          "üöÄ Universal CLI Executor"
        ],
        "security": [],
        "parameters": [
          {
            "name": "Session-ID",
            "in": "header",
            "description": "ID de sesi√≥n para continuidad de conversaci√≥n (prioridad alta)",
            "schema": {
              "type": "string",
              "example": "test_deduplicado_001"
            }
          },
          {
            "name": "Agent-ID",
            "in": "header",
            "description": "ID del agente para contexto de memoria (prioridad alta)",
            "schema": {
              "type": "string",
              "example": "TestAgent"
            }
          }
        ],
        "x-ai-features": {
          "autofix": true,
          "memory_integration": true,
          "never_fails": true,
          "agent_friendly": true
        },
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "comando": {
                    "type": "string",
                    "description": "Cualquier comando a ejecutar. Si faltan argumentos, el sistema los buscar√° autom√°ticamente en la memoria de sesi√≥n.",
                    "examples": [
                      "az group list",
                      "az storage account create",
                      "python -u script.py",
                      "npm install express",
                      "docker ps",
                      "Get-Process"
                    ]
                  },
                  "session_id": {
                    "type": "string",
                    "description": "ID de sesi√≥n para autocorrecci√≥n con memoria (opcional, se detecta autom√°ticamente)",
                    "example": "test_deduplicado_001"
                  },
                  "agent_id": {
                    "type": "string",
                    "description": "ID del agente para contexto de memoria (opcional, se detecta autom√°ticamente)",
                    "example": "TestAgent"
                  }
                },
                "required": [
                  "comando"
                ],
                "additionalProperties": true
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "‚úÖ SIEMPRE EXITOSO - Comando procesado con autocorrecci√≥n y memoria integrada",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "exito": {
                      "type": "boolean",
                      "description": "Si el comando se ejecut√≥ exitosamente"
                    },
                    "comando": {
                      "type": "string",
                      "description": "Comando ejecutado (puede ser autocorregido)"
                    },
                    "comando_original": {
                      "type": "string",
                      "description": "Comando original antes de autocorrecci√≥n"
                    },
                    "tipo_comando": {
                      "type": "string",
                      "enum": [
                        "azure_cli",
                        "python",
                        "powershell",
                        "bash",
                        "npm",
                        "docker",
                        "generic"
                      ],
                      "description": "Tipo de comando detectado autom√°ticamente"
                    },
                    "resultado": {
                      "type": "string",
                      "description": "Salida est√°ndar del comando"
                    },
                    "error": {
                      "type": "string",
                      "description": "Mensaje de error si fall√≥ (estructurado para agentes)"
                    },
                    "codigo_salida": {
                      "type": "integer",
                      "description": "C√≥digo de salida del proceso"
                    },
                    "tiempo_ejecucion": {
                      "type": "string",
                      "description": "Tiempo de ejecuci√≥n del comando"
                    },
                    "ejecutor": {
                      "type": "string",
                      "enum": [
                        "azure_cli_binary",
                        "subprocess_fallback"
                      ],
                      "description": "Ejecutor utilizado internamente"
                    },
                    "autocorreccion": {
                      "type": "object",
                      "description": "Informaci√≥n sobre autocorrecci√≥n aplicada",
                      "properties": {
                        "aplicada": {
                          "type": "boolean",
                          "description": "Si se aplic√≥ autocorrecci√≥n"
                        },
                        "argumentos_encontrados": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "argumento": {
                                "type": "string"
                              },
                              "valor": {
                                "type": "string"
                              },
                              "fuente_memoria": {
                                "type": "string"
                              }
                            }
                          },
                          "description": "Argumentos encontrados en memoria"
                        },
                        "reintentos": {
                          "type": "integer",
                          "description": "N√∫mero de reintentos realizados"
                        }
                      }
                    },
                    "diagnostico": {
                      "type": "object",
                      "description": "Informaci√≥n detallada para debugging y agentes",
                      "properties": {
                        "error_categoria": {
                          "type": "string",
                          "enum": [
                            "argumento_faltante",
                            "comando_no_encontrado",
                            "permisos",
                            "timeout",
                            "sintaxis",
                            "otro"
                          ]
                        },
                        "solucionable_con_memoria": {
                          "type": "boolean"
                        },
                        "comando_sugerido": {
                          "type": "string"
                        }
                      }
                    },
                    "accion_requerida": {
                      "type": "string",
                      "description": "Acci√≥n que debe tomar el agente para resolver el problema"
                    },
                    "sugerencias_solucion": {
                      "type": "array",
                      "items": {
                        "type": "string"
                      },
                      "description": "Sugerencias espec√≠ficas para resolver el problema"
                    },
                    "memoria": {
                      "type": "object",
                      "description": "Metadata de memoria de sesi√≥n",
                      "properties": {
                        "session_id": {
                          "type": "string"
                        },
                        "agent_id": {
                          "type": "string"
                        },
                        "comandos_previos": {
                          "type": "integer"
                        },
                        "contexto_disponible": {
                          "type": "boolean"
                        }
                      }
                    },
                    "metadata": {
                      "type": "object",
                      "properties": {
                        "run_id": {
                          "type": "string"
                        },
                        "endpoint": {
                          "type": "string"
                        },
                        "timestamp": {
                          "type": "string"
                        },
                        "version_sistema": {
                          "type": "string"
                        }
                      }
                    },
                    "timestamp": {
                      "type": "string",
                      "format": "date-time",
                      "description": "Timestamp de la ejecuci√≥n"
                    }
                  },
                  "required": [
                    "exito",
                    "comando",
                    "tipo_comando",
                    "ejecutor",
                    "timestamp"
                  ]
                }
              }
            }
          }
        }
      }
    },
    "/api/aplicar-correccion-manual": {
      "post": {
        "summary": "üîß APLICAR CORRECCI√ìN MANUAL - Endpoint universal para aplicar correcciones din√°micas",
        "description": "Endpoint adaptable que detecta autom√°ticamente el tipo de correcci√≥n y la aplica. Soporta: Cosmos DB (timeout), Azure Config, archivos locales, comandos CLI, configuraciones de app. Formato flexible sin predefiniciones r√≠gidas.",
        "operationId": "aplicarCorreccionManual",
        "tags": [
          "Correcciones Universales"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "timeout": {
                    "type": "integer",
                    "description": "Timeout en segundos (para Cosmos DB)",
                    "example": 30
                  },
                  "database": {
                    "type": "string",
                    "description": "Nombre de la base de datos",
                    "example": "cosmos-db"
                  },
                  "comando": {
                    "type": "string",
                    "description": "Comando CLI a ejecutar",
                    "example": "az storage account list"
                  },
                  "ruta": {
                    "type": "string",
                    "description": "Ruta del archivo a modificar",
                    "example": "app.json"
                  },
                  "contenido": {
                    "type": "string",
                    "description": "Contenido del archivo"
                  },
                  "configuracion": {
                    "type": "object",
                    "description": "Configuraciones a aplicar",
                    "additionalProperties": true
                  },
                  "config": {
                    "type": "object",
                    "description": "Alias para configuracion",
                    "additionalProperties": true
                  },
                  "settings": {
                    "type": "object",
                    "description": "Settings de Azure",
                    "additionalProperties": true
                  }
                },
                "additionalProperties": true,
                "examples": [
                  {
                    "timeout": 30,
                    "database": "cosmos-db"
                  },
                  {
                    "comando": "az functionapp restart --name myapp --resource-group myrg"
                  },
                  {
                    "ruta": "app.json",
                    "configuracion": {
                      "timeout": 30
                    }
                  }
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Correcci√≥n aplicada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "exito": {
                      "type": "boolean",
                      "description": "Si la correcci√≥n fue exitosa"
                    },
                    "tipo_correccion": {
                      "type": "string",
                      "enum": [
                        "cosmos_db",
                        "azure_config",
                        "archivo_local",
                        "comando_cli",
                        "configuracion_app",
                        "generico"
                      ],
                      "description": "Tipo de correcci√≥n detectado autom√°ticamente"
                    },
                    "resultado": {
                      "type": "object",
                      "description": "Detalles del resultado de la correcci√≥n"
                    },
                    "metadata": {
                      "type": "object",
                      "properties": {
                        "run_id": {
                          "type": "string"
                        },
                        "timestamp": {
                          "type": "string"
                        },
                        "endpoint": {
                          "type": "string"
                        },
                        "ambiente": {
                          "type": "string"
                        }
                      }
                    }
                  },
                  "required": [
                    "exito",
                    "tipo_correccion",
                    "resultado"
                  ]
                }
              }
            }
          },
          "400": {
            "description": "Error en la correcci√≥n"
          },
          "500": {
            "description": "Error interno del servidor"
          }
        }
      }
    },
    "/api/crear-alerta-azure": {
      "post": {
        "summary": "Crear alerta Azure Monitor para HTTP 500",
        "operationId": "crearAlertaAzure",
        "tags": [
          "Azure Monitor"
        ],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "resource_group": {
                    "type": "string",
                    "default": "boat-rental-app-group"
                  },
                  "function_app": {
                    "type": "string",
                    "default": "copiloto-semantico-func-us2"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Alerta procesada"
          }
        }
      }
    },
    "/api/escribir-archivo-local": {
      "post": {
        "summary": "Crear o guardar un archivo en el filesystem LOCAL (no Azure Blob), usando rutas absolutas o relativas",
        "description": "Permite crear o sobrescribir archivos en el sistema de archivos local del contenedor o m√°quina, usando rutas absolutas (ej: C:/ProyectosSimbolicos/boat-rental-app/scripts/test_local.py, /tmp/test.txt) o relativas (ej: scripts/test_local.py). No utiliza Azure Blob Storage. √ötil para pruebas, logs o scripts temporales. ‚ö†Ô∏è En Azure, los archivos locales son VOL√ÅTILES y se pierden al reiniciar.",
        "operationId": "escribirArchivoLocal",
        "tags": [
          "Local Storage"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "ruta": {
                    "type": "string",
                    "description": "Ruta del archivo local. Ejemplo absoluto: C:/ProyectosSimbolicos/boat-rental-app/scripts/test_local.py o /tmp/test.txt. Ejemplo relativo: scripts/test_local.py. En Azure se restringe a /home/site/wwwroot."
                  },
                  "contenido": {
                    "type": "string",
                    "description": "Contenido del archivo a escribir (texto plano)"
                  },
                  "contenido_base64": {
                    "type": "string",
                    "description": "Contenido en base64 si es un archivo binario"
                  },
                  "binario": {
                    "type": "boolean",
                    "description": "Indica si el contenido es binario"
                  },
                  "tipo_mime": {
                    "type": "string",
                    "description": "Tipo MIME opcional (ej: text/plain, image/png)"
                  }
                },
                "required": [
                  "ruta",
                  "contenido"
                ]
              },
              "examples": {
                "absoluta_windows": {
                  "summary": "Ruta absoluta en Windows",
                  "value": {
                    "ruta": "C:/ProyectosSimbolicos/boat-rental-app/scripts/test_local.py",
                    "contenido": "print('Hola mundo')"
                  }
                },
                "absoluta_linux": {
                  "summary": "Ruta absoluta en Linux",
                  "value": {
                    "ruta": "/tmp/test.txt",
                    "contenido": "Archivo temporal local"
                  }
                },
                "relativa": {
                  "summary": "Ruta relativa",
                  "value": {
                    "ruta": "scripts/test_local.py",
                    "contenido": "print('Archivo relativo')"
                  }
                }
              }
            }
          }
        },
        "responses": {
          "201": {
            "description": "Archivo creado correctamente en filesystem local",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "exito": {
                      "type": "boolean",
                      "example": true
                    },
                    "mensaje": {
                      "type": "string",
                      "example": "Archivo creado exitosamente en: C:/ProyectosSimbolicos/boat-rental-app/scripts/test_local.py"
                    },
                    "ubicacion": {
                      "type": "string",
                      "example": "file://C:/ProyectosSimbolicos/boat-rental-app/scripts/test_local.py"
                    },
                    "ruta_absoluta": {
                      "type": "string",
                      "example": "C:/ProyectosSimbolicos/boat-rental-app/scripts/test_local.py"
                    },
                    "tipo_operacion": {
                      "type": "string",
                      "example": "crear_archivo_local"
                    },
                    "tama√±o_bytes": {
                      "type": "integer",
                      "example": 1024
                    },
                    "modo_acceso": {
                      "type": "string",
                      "example": "local_filesystem"
                    },
                    "advertencia": {
                      "type": "string",
                      "example": "‚ö†Ô∏è En Azure, los archivos locales son VOL√ÅTILES y se pierden al reiniciar"
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida (ruta inv√°lida o JSON malformado)"
          },
          "500": {
            "description": "Error interno del servidor"
          }
        }
      }
    },
    "/api/leer-archivo": {
      "get": {
        "summary": "Leer archivo desde blob o sistema local",
        "operationId": "leerArchivo",
        "tags": [
          "Azure Storage"
        ],
        "security": [],
        "parameters": [
          {
            "name": "ruta",
            "in": "query",
            "description": "Ruta del archivo a leer (requerido).",
            "required": true,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "container",
            "in": "query",
            "description": "Nombre del contenedor (opcional).",
            "required": false,
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "force_refresh",
            "in": "query",
            "description": "Forzar actualizaci√≥n, omitir cache (opcional).",
            "required": false,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "include_preview",
            "in": "query",
            "description": "Incluir vista previa del archivo (opcional).",
            "required": false,
            "schema": {
              "type": "boolean"
            }
          },
          {
            "name": "max_preview_size",
            "in": "query",
            "description": "Tama√±o m√°ximo del preview (opcional).",
            "required": false,
            "schema": {
              "type": "integer"
            }
          },
          {
            "name": "semantic_analysis",
            "in": "query",
            "description": "Activar an√°lisis sem√°ntico (opcional).",
            "required": false,
            "schema": {
              "type": "boolean"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Respuesta exitosa",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object"
                }
              }
            }
          },
          "400": {
            "description": "Par√°metro requerido faltante"
          },
          "404": {
            "description": "Archivo no encontrado"
          },
          "500": {
            "description": "Error interno del servidor"
          }
        }
      }
    },
    "/api/eliminar-archivo": {
      "post": {
        "summary": "Eliminar archivo",
        "operationId": "eliminarArchivo",
        "tags": [
          "Azure Storage"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "ruta": {
                    "type": "string",
                    "description": "Ruta del archivo a eliminar"
                  }
                },
                "required": [
                  "ruta"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Archivo eliminado correctamente"
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "404": {
            "description": "Archivo no encontrado"
          }
        }
      }
    },
    "/api/listar-blobs": {
      "get": {
        "summary": "Listar blobs en el contenedor de Azure Storage",
        "description": "Permite obtener archivos almacenados en el contenedor `boat-rental-project`. Se puede usar `prefix` para filtrar por carpetas virtuales (ej: scripts/), y `top` para limitar la cantidad de resultados.",
        "operationId": "listarBlobs",
        "tags": [
          "Azure Storage"
        ],
        "security": [],
        "parameters": [
          {
            "name": "prefix",
            "in": "query",
            "schema": {
              "type": "string"
            }
          },
          {
            "name": "top",
            "in": "query",
            "schema": {
              "type": "integer",
              "default": 10
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Listado de blobs en el contenedor",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok": {
                      "type": "boolean",
                      "example": true
                    },
                    "details": {
                      "type": "object",
                      "properties": {
                        "count": {
                          "type": "integer",
                          "example": 35
                        },
                        "sample": {
                          "type": "array",
                          "items": {
                            "type": "object",
                            "properties": {
                              "name": {
                                "type": "string"
                              },
                              "size": {
                                "type": "integer"
                              },
                              "last_modified": {
                                "type": "string",
                                "format": "date-time"
                              },
                              "tipo": {
                                "type": "string"
                              }
                            }
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          }
        }
      }
    },
    "/api/deploy": {
      "post": {
        "summary": "Desplegar recursos Azure usando ARM templates",
        "operationId": "deployARM",
        "tags": [
          "Azure Deployment"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "resourceGroup": {
                    "type": "string",
                    "description": "Nombre del resource group"
                  },
                  "template": {
                    "type": "object",
                    "description": "ARM template JSON"
                  },
                  "parameters": {
                    "type": "object",
                    "description": "Par√°metros del template"
                  }
                },
                "required": [
                  "resourceGroup",
                  "template"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Deployment iniciado exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "500": {
            "description": "Error del servidor"
          }
        }
      }
    },
    "/api/configurar-cors": {
      "post": {
        "summary": "Configurar CORS para Function App",
        "operationId": "configurarCORS",
        "tags": [
          "Azure Configuration"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "allowed_origins": {
                    "type": "array",
                    "items": {
                      "type": "string"
                    }
                  }
                },
                "required": [
                  "allowed_origins"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "CORS configurado correctamente"
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "500": {
            "description": "Error del servidor"
          }
        }
      }
    },
    "/api/escalar-plan": {
      "post": {
        "summary": "Escalar App Service Plan",
        "operationId": "escalarPlan",
        "tags": [
          "Azure Configuration"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "plan_name": {
                    "type": "string",
                    "description": "Nombre del plan"
                  },
                  "sku": {
                    "type": "string",
                    "enum": [
                      "B1",
                      "B2",
                      "B3",
                      "S1",
                      "S2",
                      "S3",
                      "EP1",
                      "EP2",
                      "EP3"
                    ]
                  }
                },
                "required": [
                  "plan_name"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Plan escalado correctamente"
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "500": {
            "description": "Error del servidor"
          }
        }
      }
    },
    "/api/auditar-deploy": {
      "get": {
        "summary": "Auditar deployment actual",
        "operationId": "auditarDeploy",
        "tags": [
          "Diagn√≥stico"
        ],
        "security": [],
        "responses": {
          "200": {
            "description": "Auditor√≠a completa del deployment",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "ok": {
                      "type": "boolean"
                    },
                    "details": {
                      "type": "object",
                      "properties": {
                        "files_count": {
                          "type": "integer"
                        },
                        "function_app_py_sha256": {
                          "type": "string",
                          "nullable": true
                        },
                        "baseline_sha256": {
                          "type": "string",
                          "nullable": true
                        },
                        "match_baseline": {
                          "type": "boolean",
                          "nullable": true
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          }
        }
      }
    },
    "/api/bateria-endpoints": {
      "post": {
        "summary": "üîß BATER√çA ROBUSTA - Ejecutar bater√≠a de pruebas de endpoints",
        "description": "‚≠ê ENDPOINT ROBUSTO que ejecuta una bater√≠a completa de pruebas de endpoints. Acepta cualquier body JSON o sin body. Nunca falla por formato de entrada. Formato opcional: {} o sin body.",
        "operationId": "bateriaEndpoints",
        "tags": [
          "Testing"
        ],
        "security": [],
        "requestBody": {
          "required": false,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "additionalProperties": true,
                "description": "Body opcional - acepta cualquier JSON o sin body"
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Bater√≠a ejecutada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "summary": {
                      "type": "object",
                      "properties": {
                        "total": {
                          "type": "integer",
                          "description": "Total de endpoints probados"
                        },
                        "ok": {
                          "type": "integer",
                          "description": "Endpoints que respondieron correctamente"
                        },
                        "fail": {
                          "type": "integer",
                          "description": "Endpoints que fallaron"
                        }
                      }
                    },
                    "results": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "endpoint": {
                            "type": "string"
                          },
                          "method": {
                            "type": "string"
                          },
                          "status_code": {
                            "type": "integer"
                          },
                          "ok": {
                            "type": "boolean"
                          },
                          "data": {
                            "type": "object"
                          }
                        }
                      }
                    }
                  }
                }
              }
            }
          }
        }
      },
      "get": {
        "summary": "üîß BATER√çA ROBUSTA - Ejecutar bater√≠a de pruebas (m√©todo GET)",
        "description": "Mismo endpoint robusto pero usando m√©todo GET. √ötil para agentes que prefieren GET.",
        "operationId": "bateriaEndpointsGet",
        "tags": [
          "Testing"
        ],
        "security": [],
        "responses": {
          "200": {
            "description": "Bater√≠a ejecutada exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true
                }
              }
            }
          }
        }
      }
    },
    "/api/probar-endpoint": {
      "post": {
        "summary": "Probar un endpoint espec√≠fico",
        "operationId": "probarEndpoint",
        "tags": [
          "Testing"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "endpoint": {
                    "type": "string",
                    "description": "Endpoint a probar"
                  },
                  "method": {
                    "type": "string",
                    "enum": [
                      "GET",
                      "POST",
                      "DELETE"
                    ],
                    "default": "GET"
                  }
                },
                "required": [
                  "endpoint"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Endpoint probado",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          }
        }
      }
    },
    "/api/render-error": {
      "post": {
        "summary": "Renderizar error sem√°nticamente",
        "operationId": "renderError",
        "tags": [
          "Internal"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "error": {
                    "type": "string",
                    "description": "Error a renderizar"
                  },
                  "context": {
                    "type": "object",
                    "description": "Contexto adicional"
                  }
                },
                "required": [
                  "error"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Error renderizado sem√°nticamente",
            "content": {
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          }
        }
      }
    },
    "/api/historial-interacciones": {
      "get": {
        "summary": "üìú HISTORIAL DE INTERACCIONES - Consulta memoria de sesi√≥n",
        "description": "Consulta el historial de interacciones de una sesi√≥n espec√≠fica desde Cosmos DB. Devuelve las √∫ltimas interacciones con endpoints correctos detectados autom√°ticamente.",
        "operationId": "historialInteracciones",
        "tags": [
          "üß† Memoria Integrada"
        ],
        "security": [],
        "parameters": [
          {
            "name": "Session-ID",
            "in": "header",
            "required": true,
            "description": "ID de sesi√≥n para consultar historial",
            "schema": {
              "type": "string",
              "example": "test_deduplicado_001"
            }
          },
          {
            "name": "Agent-ID",
            "in": "header",
            "required": true,
            "description": "ID del agente",
            "schema": {
              "type": "string",
              "example": "TestAgent"
            }
          },
          {
            "name": "limit",
            "in": "query",
            "description": "N√∫mero m√°ximo de interacciones a devolver",
            "schema": {
              "type": "integer",
              "default": 10,
              "minimum": 1,
              "maximum": 50
            }
          },
          {
            "name": "session_id",
            "in": "query",
            "description": "ID de sesi√≥n como par√°metro alternativo",
            "schema": {
              "type": "string"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Historial de interacciones obtenido exitosamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "exito": {
                      "type": "boolean",
                      "example": true
                    },
                    "interacciones": {
                      "type": "array",
                      "items": {
                        "type": "object",
                        "properties": {
                          "numero": {
                            "type": "integer"
                          },
                          "timestamp": {
                            "type": "string"
                          },
                          "endpoint": {
                            "type": "string",
                            "example": "historial_interacciones"
                          },
                          "consulta": {
                            "type": "string"
                          },
                          "exito": {
                            "type": "boolean"
                          },
                          "tipo": {
                            "type": "string",
                            "example": "interaccion_usuario"
                          }
                        }
                      }
                    },
                    "total": {
                      "type": "integer"
                    },
                    "session_id": {
                      "type": "string"
                    },
                    "resumen_conversacion": {
                      "type": "string"
                    },
                    "fuente": {
                      "type": "string",
                      "example": "memory_collection"
                    },
                    "contexto_conversacion": {
                      "type": "object",
                      "properties": {
                        "mensaje": {
                          "type": "string"
                        },
                        "ultimas_consultas": {
                          "type": "string"
                        },
                        "session_id": {
                          "type": "string"
                        },
                        "ultima_actividad": {
                          "type": "string"
                        }
                      }
                    },
                    "metadata": {
                      "type": "object",
                      "properties": {
                        "memoria_aplicada": {
                          "type": "boolean"
                        },
                        "interacciones_previas": {
                          "type": "integer"
                        },
                        "endpoint_detectado": {
                          "type": "string"
                        }
                      }
                    }
                  }
                }
              }
            }
          },
          "500": {
            "description": "Error consultando historial",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "exito": {
                      "type": "boolean",
                      "example": false
                    },
                    "error": {
                      "type": "string"
                    },
                    "mensaje": {
                      "type": "string"
                    },
                    "fuente": {
                      "type": "string"
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/copiloto": {
      "get": {
        "summary": "üß† COPILOTO CON MEMORIA INTEGRADA - Endpoint principal con historial autom√°tico",
        "description": "Endpoint principal del copiloto que incluye consulta autom√°tica de memoria, detecci√≥n de intenciones de historial y respuesta directa con contexto de conversaci√≥n. Integra autom√°ticamente el sistema de memoria de Cosmos DB.",
        "operationId": "copiloto",
        "tags": [
          "üß† Memoria Integrada"
        ],
        "security": [],
        "parameters": [
          {
            "name": "Session-ID",
            "in": "header",
            "description": "ID de sesi√≥n para continuidad de conversaci√≥n (prioridad alta)",
            "schema": {
              "type": "string",
              "example": "test_deduplicado_001"
            }
          },
          {
            "name": "Agent-ID",
            "in": "header",
            "description": "ID del agente para contexto de memoria (prioridad alta)",
            "schema": {
              "type": "string",
              "example": "TestAgent"
            }
          },
          {
            "name": "session_id",
            "in": "query",
            "description": "ID de sesi√≥n como par√°metro de consulta",
            "schema": {
              "type": "string",
              "example": "test_deduplicado_001"
            }
          },
          {
            "name": "agent_id",
            "in": "query",
            "description": "ID del agente como par√°metro de consulta",
            "schema": {
              "type": "string",
              "example": "TestAgent"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Respuesta del copiloto con memoria integrada",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "properties": {
                    "copiloto": {
                      "type": "string"
                    },
                    "memoria_activa": {
                      "type": "boolean"
                    },
                    "contexto_conversacion": {
                      "type": "object",
                      "properties": {
                        "mensaje": {
                          "type": "string"
                        },
                        "ultimas_consultas": {
                          "type": "string"
                        },
                        "session_id": {
                          "type": "string"
                        }
                      }
                    },
                    "historial_detectado": {
                      "type": "boolean"
                    },
                    "interacciones_previas": {
                      "type": "array",
                      "items": {
                        "type": "object"
                      }
                    }
                  }
                }
              }
            }
          }
        }
      }
    },
    "/api/health": {
      "get": {
        "summary": "Health check",
        "operationId": "healthCheck",
        "tags": [
          "Internal"
        ],
        "security": [],
        "responses": {
          "200": {
            "description": "Servicio saludable",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          }
        }
      }
    },
    "/api/ejecutar": {
      "post": {
        "summary": "Orquestador de intenciones",
        "operationId": "ejecutar",
        "tags": [
          "Internal"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "intencion": {
                    "type": "string",
                    "description": "Intenci√≥n a ejecutar"
                  },
                  "parametros": {
                    "type": "object",
                    "description": "Par√°metros de la intenci√≥n"
                  }
                },
                "required": [
                  "intencion"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Intenci√≥n ejecutada",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          }
        }
      }
    },
    "/api/actualizar-contenedor": {
      "post": {
        "summary": "Actualizar propiedades de un contenedor en Blob Storage",
        "operationId": "actualizarContenedor",
        "tags": [
          "Azure Storage"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "nombre": {
                    "type": "string",
                    "description": "Nombre del contenedor"
                  },
                  "metadata": {
                    "type": "object",
                    "description": "Metadata a actualizar"
                  }
                },
                "required": [
                  "nombre"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Contenedor actualizado correctamente"
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "404": {
            "description": "Contenedor no encontrado"
          },
          "500": {
            "description": "Error del servidor"
          }
        }
      }
    },
    "/api/proxy-local": {
      "post": {
        "summary": "Endpoint interno de proxy",
        "operationId": "proxyLocal",
        "tags": [
          "Internal"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "url": {
                    "type": "string",
                    "description": "URL de destino"
                  },
                  "method": {
                    "type": "string",
                    "enum": [
                      "GET",
                      "POST",
                      "PUT",
                      "DELETE"
                    ],
                    "default": "GET"
                  },
                  "data": {
                    "type": "object",
                    "description": "Datos a enviar"
                  }
                },
                "required": [
                  "url"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Proxy ejecutado correctamente",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "500": {
            "description": "Error del servidor"
          }
        }
      }
    },
    "/api/info-archivo": {
      "get": {
        "summary": "Obtener metadatos de un archivo",
        "operationId": "infoArchivo",
        "tags": [
          "Azure Storage"
        ],
        "security": [],
        "parameters": [
          {
            "name": "ruta",
            "in": "query",
            "required": true,
            "schema": {
              "type": "string",
              "description": "Ruta del archivo"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "Metadatos del archivo",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": true
                }
              }
            }
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "404": {
            "description": "Archivo no encontrado"
          }
        }
      }
    },
    "/api/desplegar-funcion": {
      "post": {
        "summary": "Desplegar funci√≥n Azure",
        "operationId": "desplegarFuncion",
        "tags": [
          "Azure Deployment"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "function_name": {
                    "type": "string",
                    "description": "Nombre de la funci√≥n"
                  },
                  "code": {
                    "type": "string",
                    "description": "C√≥digo de la funci√≥n"
                  },
                  "config": {
                    "type": "object",
                    "description": "Configuraci√≥n de la funci√≥n"
                  }
                },
                "required": [
                  "function_name",
                  "code"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Funci√≥n desplegada correctamente"
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "500": {
            "description": "Error del servidor"
          }
        }
      }
    },
    "/api/configurar-app-settings": {
      "post": {
        "summary": "Configurar App Settings de Function App",
        "operationId": "configurarAppSettings",
        "tags": [
          "Azure Configuration"
        ],
        "security": [],
        "requestBody": {
          "required": true,
          "content": {
            "application/json": {
              "schema": {
                "type": "object",
                "properties": {
                  "function_app": {
                    "type": "string",
                    "description": "Nombre de la Function App"
                  },
                  "resource_group": {
                    "type": "string",
                    "description": "Resource group"
                  },
                  "settings": {
                    "type": "object",
                    "description": "Key-value pairs de configuraci√≥n"
                  }
                },
                "required": [
                  "settings"
                ]
              }
            }
          }
        },
        "responses": {
          "200": {
            "description": "Settings actualizados correctamente"
          },
          "400": {
            "description": "Solicitud inv√°lida"
          },
          "500": {
            "description": "Error del servidor"
          }
        }
      }
    }
  },
  "tags": [
    {
      "name": "Azure Storage",
      "description": "Operaciones de Azure Blob Storage"
    },
    {
      "name": "üöÄ Universal CLI Executor",
      "description": "Ejecutor universal que acepta cualquier tipo de comando sin restricciones"
    },
    {
      "name": "Diagn√≥stico",
      "description": "Diagn√≥stico y monitoreo de recursos"
    },
    {
      "name": "Azure Deployment",
      "description": "Deployment de recursos con ARM templates"
    },
    {
      "name": "Azure Configuration",
      "description": "Configuraci√≥n de recursos Azure"
    },
    {
      "name": "Testing",
      "description": "Pruebas y validaci√≥n de endpoints"
    },
    {
      "name": "Internal",
      "description": "Operaciones internas de la Function App"
    },
    {
      "name": "üß† Memoria Integrada",
      "description": "Sistema autom√°tico de memoria con consulta previa y guardado de interacciones en Cosmos DB"
    },
    {
      "name": "Local Storage",
      "description": "Operaciones en el filesystem local del contenedor"
    },
    {
      "name": "Autocorrecci√≥n",
      "description": "Endpoints relacionados con sugerencias, revisi√≥n y promoci√≥n de correcciones automatizadas o manuales."
    },
    {
      "name": "Bridge",
      "description": "Endpoints tolerantes para agentes problem√°ticos"
    },
    {
      "name": "üöÄ Despliegues Robustos",
      "description": "Sistema robusto y sem√°ntico para gesti√≥n completa de despliegues. Acepta cualquier formato, nunca falla, siempre retorna √©xito=true para compatibilidad con agentes."
    }
  ],
  "components": {
    "schemas": {
      "ErrorEnvelope": {
        "type": "object",
        "properties": {
          "ok": {
            "type": "boolean",
            "enum": [
              false
            ]
          },
          "error_code": {
            "type": "string"
          },
          "status": {
            "type": "integer",
            "nullable": true
          },
          "cause": {
            "type": "string"
          },
          "hint": {
            "type": "string",
            "nullable": true
          },
          "next_steps": {
            "type": "array",
            "items": {
              "type": "string"
            }
          },
          "trace": {
            "type": "string",
            "nullable": true
          }
        },
        "required": [
          "ok",
          "error_code"
        ]
      },
      "MoverArchivoRequest": {
        "type": "object",
        "properties": {
          "origen": {
            "type": "string",
            "description": "Ruta del archivo de origen"
          },
          "destino": {
            "type": "string",
            "description": "Ruta del archivo de destino"
          },
          "overwrite": {
            "type": "boolean",
            "default": false,
            "description": "Sobrescribir si existe"
          }
        },
        "required": [
          "origen",
          "destino"
        ]
      },
      "CopiarArchivoRequest": {
        "type": "object",
        "properties": {
          "origen": {
            "type": "string",
            "description": "Ruta del archivo de origen"
          },
          "destino": {
            "type": "string",
            "description": "Ruta del archivo de destino"
          },
          "overwrite": {
            "type": "boolean",
            "default": false,
            "description": "Sobrescribir si existe"
          }
        },
        "required": [
          "origen",
          "destino"
        ]
      },
      "PrepararScriptRequest": {
        "type": "object",
        "required": [
          "ruta"
        ],
        "properties": {
          "ruta": {
            "type": "string",
            "description": "Ruta local del script a preparar"
          },
          "tipo": {
            "type": "string",
            "description": "Tipo de script (opcional)"
          },
          "opciones": {
            "type": "object",
            "description": "Opciones adicionales (opcional)"
          },
          "metadata": {
            "type": "object",
            "description": "Metadata extra (opcional)"
          }
        }
      },
      "GestionarDespliegueRequest": {
        "type": "object",
        "properties": {
          "accion": {
            "type": "string",
            "enum": [
              "deploy",
              "rollback",
              "status",
              "validate"
            ],
            "description": "Acci√≥n a realizar"
          },
          "ambiente": {
            "type": "string",
            "enum": [
              "dev",
              "staging",
              "prod"
            ],
            "description": "Ambiente de despliegue"
          },
          "version": {
            "type": "string",
            "description": "Versi√≥n a desplegar o rollback"
          },
          "configuracion": {
            "type": "object",
            "description": "Configuraci√≥n adicional del despliegue"
          }
        },
        "required": [
          "accion",
          "ambiente"
        ]
      },
      "RespuestaGestionarDespliegueRobusta": {
        "type": "object",
        "description": "Respuesta unificada del sistema robusto de gesti√≥n de despliegues",
        "properties": {
          "exito": {
            "type": "boolean",
            "enum": [
              true
            ],
            "description": "SIEMPRE true para compatibilidad con agentes"
          },
          "accion_ejecutada": {
            "type": "string",
            "enum": [
              "detectar",
              "preparar",
              "desplegar",
              "rollback",
              "status",
              "validate",
              "error_recovery"
            ],
            "description": "Acci√≥n que se ejecut√≥ realmente"
          },
          "alias_usado": {
            "type": "string",
            "nullable": true,
            "description": "Alias o sin√≥nimo detectado en el payload"
          },
          "resultado": {
            "type": "object",
            "additionalProperties": true,
            "description": "Resultado espec√≠fico de la acci√≥n ejecutada",
            "properties": {
              "tipo": {
                "type": "string",
                "description": "Tipo de resultado"
              },
              "mensaje": {
                "type": "string",
                "description": "Mensaje descriptivo"
              },
              "comandos_sugeridos": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Comandos sugeridos para ejecutar"
              },
              "hash_funcion": {
                "type": "string",
                "description": "Hash de la funci√≥n actual (para detectar)"
              },
              "proximo_tag": {
                "type": "string",
                "description": "Pr√≥ximo tag sugerido"
              },
              "script_content": {
                "type": "string",
                "description": "Contenido del script generado (para preparar)"
              }
            }
          },
          "metadata": {
            "type": "object",
            "properties": {
              "run_id": {
                "type": "string",
                "description": "ID √∫nico de la ejecuci√≥n"
              },
              "endpoint": {
                "type": "string",
                "description": "Endpoint que proces√≥ la petici√≥n"
              },
              "timestamp": {
                "type": "string",
                "format": "date-time",
                "description": "Timestamp de la ejecuci√≥n"
              },
              "version_sistema": {
                "type": "string",
                "description": "Versi√≥n del sistema robusto"
              }
            }
          },
          "proximas_acciones": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Sugerencias de pr√≥ximos pasos"
          }
        },
        "required": [
          "exito",
          "accion_ejecutada",
          "resultado"
        ]
      },
      "Error": {
        "type": "object",
        "properties": {
          "error": {
            "type": "string"
          },
          "message": {
            "type": "string"
          },
          "code": {
            "type": "integer"
          }
        },
        "required": [
          "error"
        ]
      }
    }
  }
}